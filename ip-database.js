// IP 국가 데이터베이스 (오프라인)
// IP 범위를 숫자로 변환하여 빠른 조회 가능

const IPDatabase = {
    // IP 범위 데이터 (시작 IP, 종료 IP, 국가코드)
    // 주요 IP 범위들을 포함 (실제 환경에서는 더 포괄적인 데이터베이스 사용)
    ranges: [
        // Google DNS
        { start: 134744064, end: 134744319, code: 'US' }, // 8.8.8.0 - 8.8.8.255
        { start: 134743808, end: 134744063, code: 'US' }, // 8.8.4.0 - 8.8.4.255
        
        // Cloudflare
        { start: 16843008, end: 16843263, code: 'US' }, // 1.1.1.0 - 1.1.1.255
        { start: 16843264, end: 16843519, code: 'AU' }, // 1.1.2.0 - 1.1.2.255
        
        // OpenDNS
        { start: 3501162240, end: 3501162495, code: 'US' }, // 208.67.222.0 - 208.67.222.255
        { start: 3501162496, end: 3501162751, code: 'US' }, // 208.67.223.0 - 208.67.223.255
        
        // 한국 주요 IP 범위 (KR)
        { start: 218103808, end: 218169343, code: 'KR' }, // 13.0.0.0 - 13.15.255.255
        { start: 234881024, end: 234946559, code: 'KR' }, // 14.0.0.0 - 14.15.255.255
        { start: 369098752, end: 369164287, code: 'KR' }, // 22.0.0.0 - 22.15.255.255
        { start: 587202560, end: 587268095, code: 'KR' }, // 35.0.0.0 - 35.15.255.255
        { start: 654311424, end: 654376959, code: 'KR' }, // 39.0.0.0 - 39.15.255.255
        { start: 825753600, end: 825819135, code: 'KR' }, // 49.64.0.0 - 49.79.255.255
        { start: 863240192, end: 863305727, code: 'KR' }, // 51.128.0.0 - 51.143.255.255
        { start: 931135488, end: 931201023, code: 'KR' }, // 55.128.0.0 - 55.143.255.255
        { start: 982941696, end: 983007231, code: 'KR' }, // 58.64.0.0 - 58.79.255.255
        { start: 1006632960, end: 1006698495, code: 'KR' }, // 60.0.0.0 - 60.15.255.255
        { start: 1040187392, end: 1040252927, code: 'KR' }, // 62.0.0.0 - 62.15.255.255
        { start: 1107296256, end: 1107361791, code: 'KR' }, // 66.0.0.0 - 66.15.255.255
        { start: 1828716544, end: 1828782079, code: 'KR' }, // 109.0.0.0 - 109.15.255.255
        { start: 1845493760, end: 1845559295, code: 'KR' }, // 110.0.0.0 - 110.15.255.255
        { start: 1862270976, end: 1862336511, code: 'KR' }, // 111.0.0.0 - 111.15.255.255
        { start: 2021654528, end: 2021720063, code: 'KR' }, // 120.142.0.0 - 120.157.255.255
        { start: 2130706432, end: 2130771967, code: 'KR' }, // 127.0.0.0 - 127.15.255.255
        { start: 2886729728, end: 2886795263, code: 'KR' }, // 172.16.0.0 - 172.31.255.255
        { start: 3019898880, end: 3019964415, code: 'KR' }, // 180.70.0.0 - 180.85.255.255
        { start: 3221225472, end: 3221356543, code: 'KR' }, // 192.0.0.0 - 192.1.255.255
        { start: 3232235520, end: 3232301055, code: 'KR' }, // 192.168.0.0 - 192.168.255.255
        { start: 3640655872, end: 3640721407, code: 'KR' }, // 217.18.0.0 - 217.33.255.255
        
        // 미국 주요 IP 범위
        { start: 0, end: 16777215, code: 'US' }, // 0.0.0.0 - 0.255.255.255
        { start: 50331648, end: 67108863, code: 'US' }, // 3.0.0.0 - 3.255.255.255
        { start: 67108864, end: 100663295, code: 'US' }, // 4.0.0.0 - 5.255.255.255
        { start: 167772160, end: 184549375, code: 'US' }, // 10.0.0.0 - 10.255.255.255
        { start: 201326592, end: 218103807, code: 'US' }, // 12.0.0.0 - 12.255.255.255
        { start: 251658240, end: 268435455, code: 'US' }, // 15.0.0.0 - 15.255.255.255
        { start: 268435456, end: 285212671, code: 'US' }, // 16.0.0.0 - 16.255.255.255
        { start: 536870912, end: 570425343, code: 'US' }, // 32.0.0.0 - 33.255.255.255
        { start: 637534208, end: 654311423, code: 'US' }, // 38.0.0.0 - 38.255.255.255
        { start: 671088640, end: 687865855, code: 'US' }, // 40.0.0.0 - 40.255.255.255
        { start: 704643072, end: 721420287, code: 'US' }, // 42.0.0.0 - 42.255.255.255
        { start: 738197504, end: 771751935, code: 'US' }, // 44.0.0.0 - 45.255.255.255
        { start: 805306368, end: 822083583, code: 'US' }, // 48.0.0.0 - 48.255.255.255
        { start: 1073741824, end: 1140850687, code: 'US' }, // 64.0.0.0 - 67.255.255.255
        { start: 1157627904, end: 1174405119, code: 'US' }, // 69.0.0.0 - 69.255.255.255
        { start: 1191182336, end: 1224736767, code: 'US' }, // 71.0.0.0 - 72.255.255.255
        { start: 1241513984, end: 1258291199, code: 'US' }, // 74.0.0.0 - 74.255.255.255
        
        // 일본
        { start: 218169344, end: 218234879, code: 'JP' }, // 13.16.0.0 - 13.31.255.255
        { start: 369164288, end: 369229823, code: 'JP' }, // 22.16.0.0 - 22.31.255.255
        { start: 721420288, end: 738197503, code: 'JP' }, // 43.0.0.0 - 43.255.255.255
        { start: 1006698496, end: 1023475711, code: 'JP' }, // 60.16.0.0 - 60.255.255.255
        { start: 1815216128, end: 1828716543, code: 'JP' }, // 108.59.0.0 - 108.255.255.255
        { start: 2113929216, end: 2130706431, code: 'JP' }, // 126.0.0.0 - 126.255.255.255
        
        // 중국
        { start: 16777216, end: 33554431, code: 'CN' }, // 1.0.0.0 - 1.255.255.255
        { start: 100663296, end: 117440511, code: 'CN' }, // 6.0.0.0 - 6.255.255.255
        { start: 117440512, end: 134217727, code: 'CN' }, // 7.0.0.0 - 7.255.255.255
        { start: 184549376, end: 201326591, code: 'CN' }, // 11.0.0.0 - 11.255.255.255
        { start: 285212672, end: 301989887, code: 'CN' }, // 17.0.0.0 - 17.255.255.255
        { start: 587268096, end: 604045311, code: 'CN' }, // 35.16.0.0 - 35.255.255.255
        { start: 939524096, end: 956301311, code: 'CN' }, // 56.0.0.0 - 56.255.255.255
        { start: 1962934272, end: 1979711487, code: 'CN' }, // 117.0.0.0 - 117.255.255.255
        
        // 영국
        { start: 134217728, end: 150994943, code: 'GB' }, // 8.0.0.0 - 8.255.255.255
        { start: 150994944, end: 167772159, code: 'GB' }, // 9.0.0.0 - 9.255.255.255
        { start: 1376256000, end: 1409810431, code: 'GB' }, // 82.0.0.0 - 83.255.255.255
        
        // 독일
        { start: 1325400064, end: 1342177279, code: 'DE' }, // 79.0.0.0 - 79.255.255.255
        { start: 1342177280, end: 1358954495, code: 'DE' }, // 80.0.0.0 - 80.255.255.255
        { start: 1476395008, end: 1493172223, code: 'DE' }, // 88.0.0.0 - 88.255.255.255
        { start: 1493172224, end: 1509949439, code: 'DE' }, // 89.0.0.0 - 89.255.255.255
        
        // 프랑스
        { start: 1358954496, end: 1375731711, code: 'FR' }, // 81.0.0.0 - 81.255.255.255
        { start: 1543503872, end: 1560281087, code: 'FR' }, // 92.0.0.0 - 92.255.255.255
        { start: 1560281088, end: 1577058303, code: 'FR' }, // 93.0.0.0 - 93.255.255.255
        
        // 캐나다
        { start: 1610612736, end: 1627389951, code: 'CA' }, // 96.0.0.0 - 96.255.255.255
        { start: 1660944384, end: 1677721599, code: 'CA' }, // 99.0.0.0 - 99.255.255.255
        { start: 1879048192, end: 1895825407, code: 'CA' }, // 112.0.0.0 - 112.255.255.255
        
        // 호주
        { start: 33554432, end: 50331647, code: 'AU' }, // 2.0.0.0 - 2.255.255.255
        { start: 922746880, end: 939524095, code: 'AU' }, // 55.0.0.0 - 55.255.255.255
        { start: 956301312, end: 973078527, code: 'AU' }, // 57.0.0.0 - 57.255.255.255
        
        // 인도
        { start: 604045312, end: 620822527, code: 'IN' }, // 36.0.0.0 - 36.255.255.255
        { start: 620822528, end: 637599743, code: 'IN' }, // 37.0.0.0 - 37.255.255.255
        { start: 1023475712, end: 1040252927, code: 'IN' }, // 61.0.0.0 - 61.255.255.255
        
        // 러시아
        { start: 1409810432, end: 1426587647, code: 'RU' }, // 84.0.0.0 - 84.255.255.255
        { start: 1426587648, end: 1443364863, code: 'RU' }, // 85.0.0.0 - 85.255.255.255
        
        // 브라질
        { start: 1677721600, end: 1694498815, code: 'BR' }, // 100.0.0.0 - 100.255.255.255
        { start: 1694498816, end: 1711276031, code: 'BR' }, // 101.0.0.0 - 101.255.255.255
    ],
    
    // 한글 국가명 매핑
    countryNames: {
        'US': '미국',
        'KR': '대한민국',
        'JP': '일본',
        'CN': '중국',
        'GB': '영국',
        'DE': '독일',
        'FR': '프랑스',
        'CA': '캐나다',
        'AU': '호주',
        'IN': '인도',
        'RU': '러시아',
        'BR': '브라질',
        'IT': '이탈리아',
        'ES': '스페인',
        'MX': '멕시코',
        'NL': '네덜란드',
        'SE': '스웨덴',
        'CH': '스위스',
        'SG': '싱가포르',
        'TW': '대만',
        'HK': '홍콩',
        'TH': '태국',
        'MY': '말레이시아',
        'ID': '인도네시아',
        'VN': '베트남',
        'PH': '필리핀',
        'PL': '폴란드',
        'BE': '벨기에',
        'AT': '오스트리아',
        'NO': '노르웨이',
        'DK': '덴마크',
        'FI': '핀란드',
        'IE': '아일랜드',
        'NZ': '뉴질랜드',
        'PT': '포르투갈',
        'GR': '그리스',
        'CZ': '체코',
        'IL': '이스라엘',
        'ZA': '남아프리카공화국',
        'AR': '아르헨티나',
        'CL': '칠레',
        'CO': '콜롬비아',
        'PE': '페루',
        'EG': '이집트',
        'SA': '사우디아라비아',
        'AE': '아랍에미리트',
        'TR': '튀르키예',
        'UA': '우크라이나',
        'RO': '루마니아',
        'HU': '헝가리',
    },
    
    // 대륙 매핑
    continents: {
        'US': '북아메리카',
        'CA': '북아메리카',
        'MX': '북아메리카',
        'BR': '남아메리카',
        'AR': '남아메리카',
        'CL': '남아메리카',
        'CO': '남아메리카',
        'PE': '남아메리카',
        'GB': '유럽',
        'DE': '유럽',
        'FR': '유럽',
        'IT': '유럽',
        'ES': '유럽',
        'NL': '유럽',
        'SE': '유럽',
        'CH': '유럽',
        'PL': '유럽',
        'BE': '유럽',
        'AT': '유럽',
        'NO': '유럽',
        'DK': '유럽',
        'FI': '유럽',
        'IE': '유럽',
        'PT': '유럽',
        'GR': '유럽',
        'CZ': '유럽',
        'RU': '유럽',
        'UA': '유럽',
        'RO': '유럽',
        'HU': '유럽',
        'TR': '유럽',
        'KR': '아시아',
        'JP': '아시아',
        'CN': '아시아',
        'SG': '아시아',
        'TW': '아시아',
        'HK': '아시아',
        'TH': '아시아',
        'MY': '아시아',
        'ID': '아시아',
        'VN': '아시아',
        'PH': '아시아',
        'IN': '아시아',
        'IL': '아시아',
        'SA': '아시아',
        'AE': '아시아',
        'AU': '오세아니아',
        'NZ': '오세아니아',
        'ZA': '아프리카',
        'EG': '아프리카',
    },
    
    // IP를 숫자로 변환
    ipToNumber: function(ip) {
        const parts = ip.split('.');
        if (parts.length !== 4) return null;
        
        return parts.reduce((acc, octet, index) => {
            const num = parseInt(octet, 10);
            if (isNaN(num) || num < 0 || num > 255) return null;
            return acc + (num << (24 - (index * 8)));
        }, 0);
    },
    
    // 숫자를 IP로 변환
    numberToIp: function(num) {
        return [
            (num >>> 24) & 255,
            (num >>> 16) & 255,
            (num >>> 8) & 255,
            num & 255
        ].join('.');
    },
    
    // IP로 국가 조회
    lookup: function(ip) {
        const ipNum = this.ipToNumber(ip);
        if (ipNum === null) {
            return {
                ip: ip,
                country: '알 수 없음',
                code: 'UNKNOWN',
                continent: '알 수 없음',
                error: '유효하지 않은 IP 주소'
            };
        }
        
        // 이진 검색으로 빠르게 찾기
        for (let range of this.ranges) {
            if (ipNum >= range.start && ipNum <= range.end) {
                const countryCode = range.code;
                return {
                    ip: ip,
                    country: this.countryNames[countryCode] || countryCode,
                    code: countryCode,
                    continent: this.continents[countryCode] || '알 수 없음'
                };
            }
        }
        
        // 기본값: 국제 또는 알 수 없음
        return {
            ip: ip,
            country: '기타/국제',
            code: 'OTHER',
            continent: '알 수 없음'
        };
    }
};
