// IP 국가 데이터베이스 (오프라인)
// IP 범위를 숫자로 변환하여 빠른 조회 가능

const IPDatabase = {
    // IP 범위 데이터 (시작 IP, 종료 IP, 국가코드)
    // 주요 IP 범위들을 포함 (실제 환경에서는 더 포괄적인 데이터베이스 사용)
    ranges: [
        // Google DNS
        { start: 134744064, end: 134744319, code: 'US' }, // 8.8.8.0 - 8.8.8.255
        { start: 134743808, end: 134744063, code: 'US' }, // 8.8.4.0 - 8.8.4.255
        
        // Cloudflare
        { start: 16843008, end: 16843263, code: 'US' }, // 1.1.1.0 - 1.1.1.255
        { start: 16843264, end: 16843519, code: 'AU' }, // 1.1.2.0 - 1.1.2.255
        
        // OpenDNS
        { start: 3501162240, end: 3501162495, code: 'US' }, // 208.67.222.0 - 208.67.222.255
        { start: 3501162496, end: 3501162751, code: 'US' }, // 208.67.223.0 - 208.67.223.255
        
        // 한국 주요 IP 범위
        { start: 117440512, end: 117506047, code: 'KR' }, // 7.0.0.0 - 7.15.255.255
        { start: 182845440, end: 182910975, code: 'KR' }, // 10.224.0.0 - 10.239.255.255
        { start: 863240192, end: 863305727, code: 'KR' }, // 51.128.0.0 - 51.143.255.255
        { start: 1761607680, end: 1761673215, code: 'KR' }, // 105.0.0.0 - 105.15.255.255
        { start: 1852203008, end: 1852268543, code: 'KR' }, // 110.70.0.0 - 110.85.255.255
        { start: 2021654528, end: 2021720063, code: 'KR' }, // 120.142.0.0 - 120.157.255.255
        { start: 3019898880, end: 3019964415, code: 'KR' }, // 180.70.0.0 - 180.85.255.255
        { start: 3640655872, end: 3640721407, code: 'KR' }, // 217.18.0.0 - 217.33.255.255
        
        // 미국 주요 IP 범위
        { start: 167772160, end: 184549375, code: 'US' }, // 10.0.0.0 - 10.255.255.255
        { start: 67108864, end: 100663295, code: 'US' }, // 4.0.0.0 - 5.255.255.255
        { start: 536870912, end: 570425343, code: 'US' }, // 32.0.0.0 - 33.255.255.255
        { start: 1073741824, end: 1140850687, code: 'US' }, // 64.0.0.0 - 67.255.255.255
        
        // 일본
        { start: 235929600, end: 235995135, code: 'JP' }, // 14.16.0.0 - 14.31.255.255
        { start: 721420288, end: 721485823, code: 'JP' }, // 43.0.0.0 - 43.15.255.255
        { start: 1815216128, end: 1815281663, code: 'JP' }, // 108.59.0.0 - 108.74.255.255
        
        // 중국
        { start: 285212672, end: 285278207, code: 'CN' }, // 17.0.0.0 - 17.15.255.255
        { start: 944963584, end: 945029119, code: 'CN' }, // 56.69.0.0 - 56.84.255.255
        { start: 1962934272, end: 1962999807, code: 'CN' }, // 117.8.0.0 - 117.23.255.255
        
        // 영국
        { start: 134217728, end: 150994943, code: 'GB' }, // 8.0.0.0 - 8.255.255.255
        { start: 1376256000, end: 1392508927, code: 'GB' }, // 82.0.0.0 - 82.255.255.255
        
        // 독일
        { start: 1325400064, end: 1358954495, code: 'DE' }, // 79.0.0.0 - 80.255.255.255
        { start: 1476395008, end: 1509949439, code: 'DE' }, // 88.0.0.0 - 89.255.255.255
        
        // 프랑스
        { start: 1358954496, end: 1375731711, code: 'FR' }, // 81.0.0.0 - 81.255.255.255
        { start: 1543503872, end: 1560281087, code: 'FR' }, // 92.0.0.0 - 92.255.255.255
        
        // 캐나다
        { start: 1610612736, end: 1627389951, code: 'CA' }, // 96.0.0.0 - 96.255.255.255
        { start: 1660944384, end: 1677721599, code: 'CA' }, // 99.0.0.0 - 99.255.255.255
        
        // 호주
        { start: 16777216, end: 33554431, code: 'AU' }, // 1.0.0.0 - 1.255.255.255
        { start: 922746880, end: 939524095, code: 'AU' }, // 55.0.0.0 - 55.255.255.255
        
        // 인도
        { start: 251658240, end: 268435455, code: 'IN' }, // 15.0.0.0 - 15.255.255.255
        { start: 620756992, end: 637534207, code: 'IN' }, // 37.0.0.0 - 37.255.255.255
    ],
    
    // 한글 국가명 매핑
    countryNames: {
        'US': '미국',
        'KR': '대한민국',
        'JP': '일본',
        'CN': '중국',
        'GB': '영국',
        'DE': '독일',
        'FR': '프랑스',
        'CA': '캐나다',
        'AU': '호주',
        'IN': '인도',
        'RU': '러시아',
        'BR': '브라질',
        'IT': '이탈리아',
        'ES': '스페인',
        'MX': '멕시코',
        'NL': '네덜란드',
        'SE': '스웨덴',
        'CH': '스위스',
        'SG': '싱가포르',
        'TW': '대만',
        'HK': '홍콩',
        'TH': '태국',
        'MY': '말레이시아',
        'ID': '인도네시아',
        'VN': '베트남',
        'PH': '필리핀',
        'PL': '폴란드',
        'BE': '벨기에',
        'AT': '오스트리아',
        'NO': '노르웨이',
        'DK': '덴마크',
        'FI': '핀란드',
        'IE': '아일랜드',
        'NZ': '뉴질랜드',
        'PT': '포르투갈',
        'GR': '그리스',
        'CZ': '체코',
        'IL': '이스라엘',
        'ZA': '남아프리카공화국',
        'AR': '아르헨티나',
        'CL': '칠레',
        'CO': '콜롬비아',
        'PE': '페루',
        'EG': '이집트',
        'SA': '사우디아라비아',
        'AE': '아랍에미리트',
        'TR': '튀르키예',
        'UA': '우크라이나',
        'RO': '루마니아',
        'HU': '헝가리',
    },
    
    // 대륙 매핑
    continents: {
        'US': '북아메리카',
        'CA': '북아메리카',
        'MX': '북아메리카',
        'BR': '남아메리카',
        'AR': '남아메리카',
        'CL': '남아메리카',
        'CO': '남아메리카',
        'PE': '남아메리카',
        'GB': '유럽',
        'DE': '유럽',
        'FR': '유럽',
        'IT': '유럽',
        'ES': '유럽',
        'NL': '유럽',
        'SE': '유럽',
        'CH': '유럽',
        'PL': '유럽',
        'BE': '유럽',
        'AT': '유럽',
        'NO': '유럽',
        'DK': '유럽',
        'FI': '유럽',
        'IE': '유럽',
        'PT': '유럽',
        'GR': '유럽',
        'CZ': '유럽',
        'RU': '유럽',
        'UA': '유럽',
        'RO': '유럽',
        'HU': '유럽',
        'TR': '유럽',
        'KR': '아시아',
        'JP': '아시아',
        'CN': '아시아',
        'SG': '아시아',
        'TW': '아시아',
        'HK': '아시아',
        'TH': '아시아',
        'MY': '아시아',
        'ID': '아시아',
        'VN': '아시아',
        'PH': '아시아',
        'IN': '아시아',
        'IL': '아시아',
        'SA': '아시아',
        'AE': '아시아',
        'AU': '오세아니아',
        'NZ': '오세아니아',
        'ZA': '아프리카',
        'EG': '아프리카',
    },
    
    // IP를 숫자로 변환
    ipToNumber: function(ip) {
        const parts = ip.split('.');
        if (parts.length !== 4) return null;
        
        return parts.reduce((acc, octet, index) => {
            const num = parseInt(octet, 10);
            if (isNaN(num) || num < 0 || num > 255) return null;
            return acc + (num << (24 - (index * 8)));
        }, 0);
    },
    
    // 숫자를 IP로 변환
    numberToIp: function(num) {
        return [
            (num >>> 24) & 255,
            (num >>> 16) & 255,
            (num >>> 8) & 255,
            num & 255
        ].join('.');
    },
    
    // IP로 국가 조회
    lookup: function(ip) {
        const ipNum = this.ipToNumber(ip);
        if (ipNum === null) {
            return {
                ip: ip,
                country: '알 수 없음',
                code: 'UNKNOWN',
                continent: '알 수 없음',
                error: '유효하지 않은 IP 주소'
            };
        }
        
        // 이진 검색으로 빠르게 찾기
        for (let range of this.ranges) {
            if (ipNum >= range.start && ipNum <= range.end) {
                const countryCode = range.code;
                return {
                    ip: ip,
                    country: this.countryNames[countryCode] || countryCode,
                    code: countryCode,
                    continent: this.continents[countryCode] || '알 수 없음'
                };
            }
        }
        
        // 기본값: 국제 또는 알 수 없음
        return {
            ip: ip,
            country: '기타/국제',
            code: 'OTHER',
            continent: '알 수 없음'
        };
    }
};
